# Open with browser (IE or Edge): https://boxstarter.org/package/nr/url?https://raw.githubusercontent.com/golonac/setup/main/setup.ps

# Windows settings
Disable-UAC
Set-PSRepository -Name PSGallery -InstallationPolicy Trusted
Format-Volume -DriveLetter E -DevDrive
Set-BoxstarterTaskbarOptions -DisableSearchBox
Set-WindowsExplorerOptions -EnableShowHiddenFilesFoldersDrives -EnableShowProtectedOSFiles -EnableShowFileExtensions -EnableShowFullPathInTitleBar -EnableOpenFileExplorerToQuickAccess -EnableShowRecentFilesInQuickAccess -EnableShowFrequentFoldersInQuickAccess -EnableExpandToOpenFolder -EnableShowRibbon -EnableItemCheckBox
Disable-InternetExplorerESC
Disable-GameBarTips
Disable-BingSearch

# Open Explorer in This Computer
Set-ItemProperty -Path HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name LaunchTo -Type DWord -Value 1
# Disable advertising ID
If (-Not (Test-Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo")) {
	New-Item -Path HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo | Out-Null
}
Set-ItemProperty -Path HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo -Name Enabled -Type DWord -Value 0
# Disable Cortana
New-Item -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows' -Name 'Windows Search' -ItemType Key
New-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Windows Search' -Name AllowCortana -Type DWORD -Value 0
# Developer mode
Set-ItemProperty -Path HKLM:\Software\Microsoft\Windows\CurrentVersion\AppModelUnlock -Name AllowDevelopmentWithoutDevLicense -Value 1
# Disable News from taskbar
#Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarDu" -Type DWord -Value 0
# Hide Cortana from taskbar
#Set-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowCortanaButton -Value 0
# Hide TaskView from taskbar
#Set-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name ShowTaskViewButton -Value 0
# Hide Widgets from taskbar
Set-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name TaskbarDa -Value 0
# Left align taskbar
Set-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced -Name TaskbarAl -Value 0
# Disable Xbox Gamebar
Set-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\GameDVR" -Name AppCaptureEnabled -Type DWord -Value 0
Set-ItemProperty -Path "HKCU:\System\GameConfigStore" -Name GameDVR_Enabled -Type DWord -Value 0
# Turn off People in Taskbar
If (-Not (Test-Path "HKCU:SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\People")) {
	New-Item -Path HKCU:SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\People | Out-Null
}
Set-ItemProperty -Path "HKCU:SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\People" -Name PeopleBand -Type DWord -Value 0
# Disable Telemetry
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" -Name "AllowTelemetry" -Type DWord -Value 0
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection" -Name "AllowTelemetry" -Type DWord -Value 0
Set-ItemProperty -Path "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Policies\DataCollection" -Name "AllowTelemetry" -Type DWord -Value 0
Disable-ScheduledTask -TaskName "Microsoft\Windows\Application Experience\Microsoft Compatibility Appraiser" | Out-Null
Disable-ScheduledTask -TaskName "Microsoft\Windows\Application Experience\ProgramDataUpdater" | Out-Null
Disable-ScheduledTask -TaskName "Microsoft\Windows\Autochk\Proxy" | Out-Null
Disable-ScheduledTask -TaskName "Microsoft\Windows\Customer Experience Improvement Program\Consolidator" | Out-Null
Disable-ScheduledTask -TaskName "Microsoft\Windows\Customer Experience Improvement Program\UsbCeip" | Out-Null
Disable-ScheduledTask -TaskName "Microsoft\Windows\DiskDiagnostic\Microsoft-Windows-DiskDiagnosticDataCollector" | Out-Null
# Disable Feedback
If (!(Test-Path "HKCU:\SOFTWARE\Microsoft\Siuf\Rules")) {
  New-Item -Path "HKCU:\SOFTWARE\Microsoft\Siuf\Rules" -Force | Out-Null
}
Set-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Siuf\Rules" -Name "NumberOfSIUFInPeriod" -Type DWord -Value 0
Disable-ScheduledTask -TaskName "Microsoft\Windows\Feedback\Siuf\DmClient" -ErrorAction SilentlyContinue | Out-Null
Disable-ScheduledTask -TaskName "Microsoft\Windows\Feedback\Siuf\DmClientOnScenarioDownload" -ErrorAction SilentlyContinue | Out-Null
# Disable Advertising ID
If (!(Test-Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo")) {
  New-Item -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo" | Out-Null
}
Set-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo" -Name "Enabled" -Type DWord -Value 0
If (!(Test-Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Privacy")) {
  New-Item -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Privacy" | Out-Null
}
Set-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Privacy" -Name "TailoredExperiencesWithDiagnosticDataEnabled" -Type DWord -Value 0
# Set the current network as Private
Get-NetConnectionProfile | Set-NetConnectionProfile -NetworkCategory Private
# Disable Sticky Keys
Set-ItemProperty -Path "HKCU:\Control Panel\Accessibility\StickyKeys" -Name "Flags" -Type String -Value "506"
# Hide 3D Objects from This PC
Remove-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace\{0DB7E03F-FC29-4DC6-9020-FF41B59E513A}" -Recurse -ErrorAction SilentlyContinue
# Hide 3D Objects from Explorer
If (!(Test-Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{31C0DD25-9439-4F12-BF41-7FF4EDA38722}\PropertyBag")) {
  New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{31C0DD25-9439-4F12-BF41-7FF4EDA38722}\PropertyBag" -Force | Out-Null
}
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{31C0DD25-9439-4F12-BF41-7FF4EDA38722}\PropertyBag" -Name "ThisPCPolicy" -Type String -Value "Hide"
If (!(Test-Path "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{31C0DD25-9439-4F12-BF41-7FF4EDA38722}\PropertyBag")) {
  New-Item -Path "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{31C0DD25-9439-4F12-BF41-7FF4EDA38722}\PropertyBag" -Force | Out-Null
}
Set-ItemProperty -Path "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{31C0DD25-9439-4F12-BF41-7FF4EDA38722}\PropertyBag" -Name "ThisPCPolicy" -Type String -Value "Hide"
# Remove Fax
Remove-Printer -Name "Fax" -ErrorAction:SilentlyContinue
# Azure PowerShell modules
Install-Module -Name AzureRM -Scope AllUsers
Install-Module -Name Azure -Scope AllUsers -AllowClobber

# Core
choco install powershell-core
choco install nodejs
choco install git
choco install gsudo
choco install python
choco install python3
choco install poshgit
choco install oh-my-posh
refreshenv
# $env:Path += ";C:\Users\user\AppData\Local\Programs\oh-my-posh\bin"
oh-my-posh font install RobotoMono
Add-Content -Path $PROFILE -Value 'oh-my-posh init pwsh --config "$env:POSH_THEMES_PATH\cobalt2.omp.json" | Invoke-Expression'

# IDE
choco install vscode
choco install visualstudio2022community
choco install sql-server-management-studio

# Browsers
choco install googlechrome
choco install firefox

# Tools
choco install 7zip
choco install winmerge
choco install slack
choco install spotify
choco install tidal
choco install postman
choco install mouse-jiggler
choco install terraform
choco install forticlientvpn
choco install azure-cosmosdb-emulator
choco install keepass
#choco install vcredist140
#choco install vcredist2015
#choco install visualstudio2017buildtools
#choco install visualstudio2019-workload-vctools
#choco install visualstudio2019buildtools
choco install docker-desktop
choco install docker-compose
#choco install minikube

# NPM
refreshenv
npm install -g typescript
npm install -g @angular/cli

# Config files from OneDrive
$vscodePath = Join-Path "$env:APPDATA" "Code/User"
$vscodeRoamingPath = Join-Path "$env:OneDriveConsumer" "Setup/VSCode"
$roamingItems = @{
  (Join-Path $vscodePath "settings.json") = (Join-Path $vscodeRoamingPath "settings.json")
  (Join-Path $vscodePath "keyBindings.json") = (Join-Path $vscodeRoamingPath "keyBindings.json")
  (Join-Path $vscodePath "snippets/") = (Join-Path $vscodeRoamingPath "snippets/")
  (Join-Path $env:LOCALAPPDATA "Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json") = (Join-Path "$env:OneDriveConsumer" "Setup/Terminal/settings.json")
}
foreach ($localItemPath in $roamingItems.Keys) {
  if (Test-Path $localItemPath) {
    $existingItem = Get-Item $localItemPath
    if ($existingItem.LinkType -eq "SymbolicLink") {
      Write-Host "Local item '$localItemPath' already redirected to '$($existingItem.Target)'"
    }
    else {
      Write-Warning "Local item '$localItemPath' already exists.  Not linking to OneDrive"
    }
  }
  else {
    $roamingItemPath = $roamingItems[$localItemPath]
    New-Item -ItemType SymbolicLink -Path $localItemPath -Target $roamingItemPath -Whatif 
  }
}
#Add-PoshGitToProfile -AllHosts

# Windows Updates
Install-WindowsUpdate

# Taskbar
Install-ChocolateyPinnedTaskBarItem "$(${env:ProgramFiles(x86)})\Google\Chrome\Application\chrome.exe"
Install-ChocolateyPinnedTaskBarItem "$($env:ProgramFiles)\Microsoft Visual Studio\2022\Community\Common7\IDE\devenv.exe"
Install-ChocolateyPinnedTaskBarItem "$($env:LOCALAPPDATA)\Programs\Microsoft VS Code\Code.exe"
Install-ChocolateyPinnedTaskBarItem "$($env:LOCALAPPDATA)\Postman\Postman.exe"
Install-ChocolateyPinnedTaskBarItem "$($env:LOCALAPPDATA)\slack\slack.exe"

# NAS, GIT config
$nasuser = Read-Host -Prompt "NAS username"
$naspwd = Read-Host -Prompt "NAS password"
net use Y: \\192.168.1.113\Media $naspwd /USER:$nasuser
net use Z: \\192.168.1.113\Photos $naspwd /USER:$nasuser
$gitusername = Read-Host -Prompt "GIT user full name"
$gituseremail = Read-Host -Prompt "GIT user email"
git config --global user.name "$gitusername"
git config --global user.email "$gituseremail"

Set-Checkpoint -CheckpointName Install -CheckpointValue 1
Enable-UAC
